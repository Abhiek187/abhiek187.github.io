let H=-1;const m=t=>{addEventListener("pageshow",e=>{e.persisted&&(H=e.timeStamp,t(e))},!0)},l=(t,e,r,n)=>{let i,s;return a=>{e.value>=0&&(a||n)&&(s=e.value-(i??0),(s||i===void 0)&&(i=e.value,e.delta=s,e.rating=((o,d)=>o>d[1]?"poor":o>d[0]?"needs-improvement":"good")(e.value,r),t(e)))}},P=t=>{requestAnimationFrame(()=>requestAnimationFrame(()=>t()))},E=()=>{const t=performance.getEntriesByType("navigation")[0];if(t&&t.responseStart>0&&t.responseStart<performance.now())return t},p=()=>E()?.activationStart??0,u=(t,e=-1)=>{const r=E();let n="navigate";return H>=0?n="back-forward-cache":r&&(document.prerendering||p()>0?n="prerender":document.wasDiscarded?n="restore":r.type&&(n=r.type.replace(/_/g,"-"))),{name:t,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:n}},y=new WeakMap;function S(t,e){return y.get(t)||y.set(t,new e),y.get(t)}class ${t;i=0;o=[];h(e){if(e.hadRecentInput)return;const r=this.o[0],n=this.o.at(-1);this.i&&r&&n&&e.startTime-n.startTime<1e3&&e.startTime-r.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),this.t?.(e)}}const v=(t,e,r={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const n=new PerformanceObserver(i=>{Promise.resolve().then(()=>{e(i.getEntries())})});return n.observe({type:t,buffered:!0,...r}),n}}catch{}},A=t=>{let e=!1;return()=>{e||(t(),e=!0)}};let h=-1;const I=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,g=t=>{document.visibilityState==="hidden"&&h>-1&&(h=t.type==="visibilitychange"?t.timeStamp:0,_())},w=()=>{addEventListener("visibilitychange",g,!0),addEventListener("prerenderingchange",g,!0)},_=()=>{removeEventListener("visibilitychange",g,!0),removeEventListener("prerenderingchange",g,!0)},R=()=>{if(h<0){const t=p();h=(document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter(r=>r.name==="hidden"&&r.startTime>t)[0]?.startTime)??I(),w(),m(()=>{setTimeout(()=>{h=I(),w()})})}return{get firstHiddenTime(){return h}}},T=t=>{document.prerendering?addEventListener("prerenderingchange",()=>t(),!0):t()},M=[1800,3e3],W=(t,e={})=>{T(()=>{const r=R();let n,i=u("FCP");const s=v("paint",a=>{for(const o of a)o.name==="first-contentful-paint"&&(s.disconnect(),o.startTime<r.firstHiddenTime&&(i.value=Math.max(o.startTime-p(),0),i.entries.push(o),n(!0)))});s&&(n=l(t,i,M,e.reportAllChanges),m(a=>{i=u("FCP"),n=l(t,i,M,e.reportAllChanges),P(()=>{i.value=performance.now()-a.timeStamp,n(!0)})}))})},F=[.1,.25],K=(t,e={})=>{W(A(()=>{let r,n=u("CLS",0);const i=S(e,$),s=o=>{for(const d of o)i.h(d);i.i>n.value&&(n.value=i.i,n.entries=i.o,r())},a=v("layout-shift",s);a&&(r=l(t,n,F,e.reportAllChanges),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(s(a.takeRecords()),r(!0))}),m(()=>{i.i=0,n=u("CLS",0),r=l(t,n,F,e.reportAllChanges),P(()=>r())}),setTimeout(r))}))};let D=0,b=1/0,f=0;const j=t=>{for(const e of t)e.interactionId&&(b=Math.min(b,e.interactionId),f=Math.max(f,e.interactionId),D=f?(f-b)/7+1:0)};let C;const k=()=>C?D:performance.interactionCount??0,z=()=>{"interactionCount"in performance||C||(C=v("event",j,{type:"event",buffered:!0,durationThreshold:0}))};let B=0;class G{u=[];l=new Map;m;v;p(){B=k(),this.u.length=0,this.l.clear()}P(){const e=Math.min(this.u.length-1,Math.floor((k()-B)/50));return this.u[e]}h(e){if(this.m?.(e),!e.interactionId&&e.entryType!=="first-input")return;const r=this.u.at(-1);let n=this.l.get(e.interactionId);if(n||this.u.length<10||e.duration>r.T){if(n?e.duration>n.T?(n.entries=[e],n.T=e.duration):e.duration===n.T&&e.startTime===n.entries[0].startTime&&n.entries.push(e):(n={id:e.interactionId,entries:[e],T:e.duration},this.l.set(n.id,n),this.u.push(n)),this.u.sort((i,s)=>s.T-i.T),this.u.length>10){const i=this.u.splice(10);for(const s of i)this.l.delete(s.id)}this.v?.(n)}}}const O=t=>{const e=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?t():(t=A(t),document.addEventListener("visibilitychange",t,{once:!0}),e(()=>{t(),document.removeEventListener("visibilitychange",t)}))},x=[200,500],Q=(t,e={})=>{globalThis.PerformanceEventTiming&&"interactionId"in PerformanceEventTiming.prototype&&T(()=>{z();let r,n=u("INP");const i=S(e,G),s=o=>{O(()=>{for(const c of o)i.h(c);const d=i.P();d&&d.T!==n.value&&(n.value=d.T,n.entries=d.entries,r())})},a=v("event",s,{durationThreshold:e.durationThreshold??40});r=l(t,n,x,e.reportAllChanges),a&&(a.observe({type:"first-input",buffered:!0}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(s(a.takeRecords()),r(!0))}),m(()=>{i.p(),n=u("INP"),r=l(t,n,x,e.reportAllChanges)}))})};class J{m;h(e){this.m?.(e)}}const N=[2500,4e3],U=(t,e={})=>{T(()=>{const r=R();let n,i=u("LCP");const s=S(e,J),a=d=>{e.reportAllChanges||(d=d.slice(-1));for(const c of d)s.h(c),c.startTime<r.firstHiddenTime&&(i.value=Math.max(c.startTime-p(),0),i.entries=[c],n())},o=v("largest-contentful-paint",a);if(o){n=l(t,i,N,e.reportAllChanges);const d=A(()=>{a(o.takeRecords()),o.disconnect(),n(!0)});for(const c of["keydown","click","visibilitychange"])addEventListener(c,()=>O(d),{capture:!0,once:!0});m(c=>{i=u("LCP"),n=l(t,i,N,e.reportAllChanges),P(()=>{i.value=performance.now()-c.timeStamp,n(!0)})})}})},q=[800,1800],L=t=>{document.prerendering?T(()=>L(t)):document.readyState!=="complete"?addEventListener("load",()=>L(t),!0):setTimeout(t)},V=(t,e={})=>{let r=u("TTFB"),n=l(t,r,q,e.reportAllChanges);L(()=>{const i=E();i&&(r.value=Math.max(i.responseStart-p(),0),r.entries=[i],n(!0),m(()=>{r=u("TTFB",0),n=l(t,r,q,e.reportAllChanges),n(!0)}))})};export{F as CLSThresholds,M as FCPThresholds,x as INPThresholds,N as LCPThresholds,q as TTFBThresholds,K as onCLS,W as onFCP,Q as onINP,U as onLCP,V as onTTFB};
