var _=Object.defineProperty;var W=(t,e,r)=>e in t?_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var h=(t,e,r)=>W(t,typeof e!="symbol"?e+"":e,r);let R=-1;const p=t=>{addEventListener("pageshow",e=>{e.persisted&&(R=e.timeStamp,t(e))},!0)},l=(t,e,r,n)=>{let i,o;return s=>{e.value>=0&&(s||n)&&(o=e.value-(i??0),(o||i===void 0)&&(i=e.value,e.delta=o,e.rating=((a,d)=>a>d[1]?"poor":a>d[0]?"needs-improvement":"good")(e.value,r),t(e)))}},S=t=>{requestAnimationFrame(()=>requestAnimationFrame(()=>t()))},E=()=>{const t=performance.getEntriesByType("navigation")[0];if(t&&t.responseStart>0&&t.responseStart<performance.now())return t},T=()=>{const t=E();return(t==null?void 0:t.activationStart)??0},u=(t,e=-1)=>{const r=E();let n="navigate";return R>=0?n="back-forward-cache":r&&(document.prerendering||T()>0?n="prerender":document.wasDiscarded?n="restore":r.type&&(n=r.type.replace(/_/g,"-"))),{name:t,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:n}},C=new WeakMap;function A(t,e){return C.get(t)||C.set(t,new e),C.get(t)}class j{constructor(){h(this,"t");h(this,"i",0);h(this,"o",[])}h(e){var i;if(e.hadRecentInput)return;const r=this.o[0],n=this.o.at(-1);this.i&&r&&n&&e.startTime-n.startTime<1e3&&e.startTime-r.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),(i=this.t)==null||i.call(this,e)}}const v=(t,e,r={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const n=new PerformanceObserver(i=>{Promise.resolve().then(()=>{e(i.getEntries())})});return n.observe({type:t,buffered:!0,...r}),n}}catch{}},I=t=>{let e=!1;return()=>{e||(t(),e=!0)}};let m=-1;const w=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,g=t=>{document.visibilityState==="hidden"&&m>-1&&(m=t.type==="visibilitychange"?t.timeStamp:0,z())},M=()=>{addEventListener("visibilitychange",g,!0),addEventListener("prerenderingchange",g,!0)},z=()=>{removeEventListener("visibilitychange",g,!0),removeEventListener("prerenderingchange",g,!0)},D=()=>{var t;return m<0&&(m=(document.prerendering||(t=globalThis.performance.getEntriesByType("visibility-state").filter(r=>r.name==="hidden")[0])==null?void 0:t.startTime)??w(),M(),p(()=>{setTimeout(()=>{m=w(),M()})})),{get firstHiddenTime(){return m}}},y=t=>{document.prerendering?addEventListener("prerenderingchange",()=>t(),!0):t()},F=[1800,3e3],G=(t,e={})=>{y(()=>{const r=D();let n,i=u("FCP");const o=v("paint",s=>{for(const a of s)a.name==="first-contentful-paint"&&(o.disconnect(),a.startTime<r.firstHiddenTime&&(i.value=Math.max(a.startTime-T(),0),i.entries.push(a),n(!0)))});o&&(n=l(t,i,F,e.reportAllChanges),p(s=>{i=u("FCP"),n=l(t,i,F,e.reportAllChanges),S(()=>{i.value=performance.now()-s.timeStamp,n(!0)})}))})},k=[.1,.25],X=(t,e={})=>{G(I(()=>{let r,n=u("CLS",0);const i=A(e,j),o=a=>{for(const d of a)i.h(d);i.i>n.value&&(n.value=i.i,n.entries=i.o,r())},s=v("layout-shift",o);s&&(r=l(t,n,k,e.reportAllChanges),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(o(s.takeRecords()),r(!0))}),p(()=>{i.i=0,n=u("CLS",0),r=l(t,n,k,e.reportAllChanges),S(()=>r())}),setTimeout(r))}))};let O=0,b=1/0,f=0;const J=t=>{for(const e of t)e.interactionId&&(b=Math.min(b,e.interactionId),f=Math.max(f,e.interactionId),O=f?(f-b)/7+1:0)};let L;const B=()=>L?O:performance.interactionCount??0,K=()=>{"interactionCount"in performance||L||(L=v("event",J,{type:"event",buffered:!0,durationThreshold:0}))};let x=0;class Q{constructor(){h(this,"u",[]);h(this,"l",new Map);h(this,"m");h(this,"p")}v(){x=B(),this.u.length=0,this.l.clear()}P(){const e=Math.min(this.u.length-1,Math.floor((B()-x)/50));return this.u[e]}h(e){var i,o;if((i=this.m)==null||i.call(this,e),!e.interactionId&&e.entryType!=="first-input")return;const r=this.u.at(-1);let n=this.l.get(e.interactionId);if(n||this.u.length<10||e.duration>r.T){if(n?e.duration>n.T?(n.entries=[e],n.T=e.duration):e.duration===n.T&&e.startTime===n.entries[0].startTime&&n.entries.push(e):(n={id:e.interactionId,entries:[e],T:e.duration},this.l.set(n.id,n),this.u.push(n)),this.u.sort((s,a)=>a.T-s.T),this.u.length>10){const s=this.u.splice(10);for(const a of s)this.l.delete(a.id)}(o=this.p)==null||o.call(this,n)}}}const $=t=>{const e=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?t():(e(t=I(t)),document.addEventListener("visibilitychange",t,{once:!0}))},N=[200,500],Y=(t,e={})=>{globalThis.PerformanceEventTiming&&"interactionId"in PerformanceEventTiming.prototype&&y(()=>{K();let r,n=u("INP");const i=A(e,Q),o=a=>{$(()=>{for(const c of a)i.h(c);const d=i.P();d&&d.T!==n.value&&(n.value=d.T,n.entries=d.entries,r())})},s=v("event",o,{durationThreshold:e.durationThreshold??40});r=l(t,n,N,e.reportAllChanges),s&&(s.observe({type:"first-input",buffered:!0}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(o(s.takeRecords()),r(!0))}),p(()=>{i.v(),n=u("INP"),r=l(t,n,N,e.reportAllChanges)}))})};class U{constructor(){h(this,"m")}h(e){var r;(r=this.m)==null||r.call(this,e)}}const q=[2500,4e3],Z=(t,e={})=>{y(()=>{const r=D();let n,i=u("LCP");const o=A(e,U),s=d=>{e.reportAllChanges||(d=d.slice(-1));for(const c of d)o.h(c),c.startTime<r.firstHiddenTime&&(i.value=Math.max(c.startTime-T(),0),i.entries=[c],n())},a=v("largest-contentful-paint",s);if(a){n=l(t,i,q,e.reportAllChanges);const d=I(()=>{s(a.takeRecords()),a.disconnect(),n(!0)});for(const c of["keydown","click","visibilitychange"])addEventListener(c,()=>$(d),{capture:!0,once:!0});p(c=>{i=u("LCP"),n=l(t,i,q,e.reportAllChanges),S(()=>{i.value=performance.now()-c.timeStamp,n(!0)})})}})},H=[800,1800],P=t=>{document.prerendering?y(()=>P(t)):document.readyState!=="complete"?addEventListener("load",()=>P(t),!0):setTimeout(t)},ee=(t,e={})=>{let r=u("TTFB"),n=l(t,r,H,e.reportAllChanges);P(()=>{const i=E();i&&(r.value=Math.max(i.responseStart-T(),0),r.entries=[i],n(!0),p(()=>{r=u("TTFB",0),n=l(t,r,H,e.reportAllChanges),n(!0)}))})};export{k as CLSThresholds,F as FCPThresholds,N as INPThresholds,q as LCPThresholds,H as TTFBThresholds,X as onCLS,G as onFCP,Y as onINP,Z as onLCP,ee as onTTFB};
